import{c as A,g as I,t as c,a as B,G as a,b as $,l as D,d as T,e as L,f as W,u as H,h as z,j as e,T as F,r as _}from"./file-utils.DX0U2p6k.js";import{r as w}from"./index.BIjdzmyy.js";import{d as M,X as G,B as Y,C as V}from"./dayjs.min.Dp2xc-th.js";const K=[["rect",{width:"20",height:"5",x:"2",y:"3",rx:"1",key:"1wp1u1"}],["path",{d:"M4 8v11a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8",key:"1s80jp"}],["path",{d:"M10 12h4",key:"a56b0p"}]],U=A("archive",K),X=[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]],P=A("trash-2",X);async function q(e){if(!e||0===e.length)throw new Error("éœ€è¦ slugs");const s=await I(),t=c.loading("æ­£åœ¨åˆå§‹åŒ–åˆ é™¤æ“ä½œ...");try{c.loading("æ­£åœ¨èŽ·å–åˆ†æ”¯ä¿¡æ¯...",{id:t});const n=(await B(s,a.OWNER,a.REPO,`heads/${a.BRANCH}`)).sha,r=(await $(s,a.OWNER,a.REPO,n)).tree.sha;c.loading("æ­£åœ¨æ‰«æåšå®¢æ–‡ä»¶...",{id:t});const i=await D(s,a.OWNER,a.REPO,"src/content/blog",a.BRANCH),o=await T(s,a.OWNER,a.REPO,"public/images",a.BRANCH),l=[];for(const n of e){c.loading(`æ­£åœ¨å¤„ç†: ${n}...`,{id:t});const e=o.find((e=>e.name.toLowerCase()===n.toLowerCase()&&"dir"===e.type));if(e){const t=await D(s,a.OWNER,a.REPO,e.path,a.BRANCH);for(const e of t)l.push({path:e,mode:"100644",type:"blob",sha:null})}const r=`src/content/blog/${n}.md`,d=`src/content/blog/${n}.mdx`,h=i.find((e=>e.toLowerCase()===r.toLowerCase()));h&&l.push({path:h,mode:"100644",type:"blob",sha:null});const m=i.find((e=>e.toLowerCase()===d.toLowerCase()));m&&l.push({path:m,mode:"100644",type:"blob",sha:null}),!h&&!m&&console.warn(`æœªæ‰¾åˆ°æ–‡ç« æ–‡ä»¶: ${n}`)}if(0===l.length)return void c.info("æ²¡æœ‰éœ€è¦åˆ é™¤çš„æ–‡ä»¶",{id:t});c.loading("æ­£åœ¨åˆ›å»ºæ–‡ä»¶æ ‘...",{id:t});const d=await L(s,a.OWNER,a.REPO,l,r),h=1===e.length?`åˆ é™¤æ–‡ç« : ${e[0]}`:`æ‰¹é‡åˆ é™¤æ–‡ç« : ${e.length} ç¯‡`;c.loading("æ­£åœ¨åˆ›å»ºæäº¤...",{id:t});const m=await W(s,a.OWNER,a.REPO,h,d.sha,[n]);c.loading("æ­£åœ¨æ›´æ–°åˆ†æ”¯...",{id:t}),await H(s,a.OWNER,a.REPO,`heads/${a.BRANCH}`,m.sha),c.success("æ‰¹é‡åˆ é™¤æˆåŠŸï¼è¯·ç­‰å¾…é¡µé¢éƒ¨ç½²åŽåˆ·æ–°",{id:t})}catch(e){throw console.error(e),c.error(e.message||"åˆ é™¤å¤±è´¥",{id:t}),e}}function ee({posts:s,labels:a,dateFormat:t}){const{isAuth:n,setPrivateKey:r}=z(),[i,o]=w.useState(!1),[l,d]=w.useState(new Set),[h,m]=w.useState(!1),p=w.useRef(null),x=w.useMemo((()=>{const e=new Map;return s.forEach((s=>{const a=M(s.data.pubDate),t=a.format("YYYY"),n=a.format("M");e.has(t)||e.set(t,new Map);const r=e.get(t);r.has(n)||r.set(n,[]),r.get(n).push(s)})),e}),[s]),g=Array.from(x.keys()).sort(((e,s)=>parseInt(s)-parseInt(e))),u=()=>{o(!i),d(new Set)},b=e=>{const s=new Set(l);s.has(e)?s.delete(e):s.add(e),d(s)},j=async()=>{try{m(!0),await q(Array.from(l)),o(!1),d(new Set)}catch(e){console.error(e),c.error(e.message||"åˆ é™¤å¤±è´¥")}finally{m(!1)}},f=e=>{const s=parseInt(e)-1;return a.months[s]||e};return e.jsxs(e.Fragment,{children:[e.jsx(F,{richColors:!0,position:"top-center",toastOptions:{className:"shadow-xl rounded-2xl border-2 border-primary/20 backdrop-blur-sm",style:{fontSize:"1rem",padding:"14px 20px",zIndex:"999999",borderRadius:"12px",boxShadow:"0 10px 40px rgba(0, 0, 0, 0.15)",transition:"all 0.3s ease-in-out"},classNames:{title:"text-lg font-semibold tracking-tight",description:"text-sm font-medium opacity-90",error:"bg-error/95 text-error-content border-error/30",success:"bg-success/95 text-success-content border-success/30",warning:"bg-warning/95 text-warning-content border-warning/30",info:"bg-info/95 text-info-content border-info/30"},duration:5e3,closeButton:!1}}),e.jsx("input",{ref:p,type:"file",accept:".pem",className:"hidden",onChange:async e=>{const s=e.target.files?.[0];s&&await(async e=>{try{const s=await _(e);r(s),c.success("å¯†é’¥å¯¼å…¥æˆåŠŸï¼Œæ­£åœ¨ç»§ç»­åˆ é™¤..."),await j()}catch(e){console.error(e),c.error("è¯»å–å¯†é’¥å¤±è´¥")}})(s),e.currentTarget&&(e.currentTarget.value="")}}),e.jsxs("div",{className:"bg-base-100 rounded-2xl shadow-lg w-full p-4 sm:p-6 mb-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(U,{className:"w-6 h-6 text-accent"}),e.jsx("h1",{className:"text-2xl md:text-3xl font-bold",children:a.archivePage}),e.jsxs("div",{className:"badge badge-accent",children:[s.length," ",1===s.length?a.post:a.posts]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[i?e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:async()=>{if(0!==l.size&&confirm(`ç¡®å®šè¦åˆ é™¤é€‰ä¸­çš„ ${l.size} ç¯‡æ–‡ç« å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ã€‚`)){if(!n)return c.info("è¯·å¯¼å…¥ç§é’¥ä»¥ç»§ç»­åˆ é™¤æ“ä½œ"),void p.current?.click();await j()}},disabled:h||0===l.size,className:"btn btn-error btn-sm gap-2",children:[e.jsx(P,{className:"w-4 h-4"}),e.jsxs("span",{children:["åˆ é™¤ (",l.size,")"]})]}),e.jsxs("button",{onClick:u,disabled:h,className:"btn btn-ghost btn-sm gap-2",children:[e.jsx(G,{className:"w-4 h-4"}),e.jsx("span",{children:"å–æ¶ˆ"})]})]}):e.jsxs("button",{onClick:u,className:"btn btn-outline btn-error btn-sm gap-2",children:[e.jsx(P,{className:"w-4 h-4"}),e.jsx("span",{children:"æ‰¹é‡åˆ é™¤"})]}),e.jsxs("a",{href:"/blog",className:"btn btn-outline btn-sm gap-2",children:[e.jsx(Y,{className:"w-4 h-4"}),e.jsx("span",{children:a.backToBlog})]})]})]}),e.jsx("div",{className:"divider my-2"}),e.jsx("p",{className:"text-sm opacity-75",children:a.archivePageDescription})]}),e.jsx("div",{className:"bg-base-100 rounded-2xl shadow-lg w-full p-4 sm:p-6",children:e.jsx("div",{className:"archives-container",children:g.length>0?e.jsx("div",{className:"archives-timeline",children:g.map((s=>e.jsxs("div",{className:"timeline-year",children:[e.jsx("div",{className:"year-header",children:e.jsx("div",{className:"year-badge",children:s})}),e.jsx("div",{className:"year-content",children:Array.from(x.get(s).entries()).sort(((e,s)=>parseInt(s[0])-parseInt(e[0]))).map((([a,n])=>e.jsxs("div",{className:"timeline-month",children:[e.jsxs("h3",{className:"month-title",children:[e.jsx(V,{className:"month-icon"}),e.jsxs("span",{children:[f(a)," ",s]}),e.jsx("span",{className:"month-count",children:n.length})]}),e.jsx("ul",{className:"archive-posts",children:n.map((s=>e.jsx("li",{className:"archive-item",children:e.jsxs("div",{className:"flex items-center gap-2 w-full",children:[i&&e.jsx("input",{type:"checkbox",className:"checkbox checkbox-sm checkbox-error shrink-0",checked:l.has(s.slug),onChange:()=>b(s.slug)}),e.jsxs("a",{href:`/blog/${s.slug}`,className:"archive-card flex-1 block "+(i&&l.has(s.slug)?"!border-error !bg-error/5":""),onClick:e=>{i&&(e.preventDefault(),b(s.slug))},children:[e.jsx("time",{className:"archive-date",children:M(s.data.pubDate).format(t)}),e.jsx("h4",{className:"archive-title",children:s.data.title}),s.data.description&&e.jsx("p",{className:"archive-description",children:s.data.description})]})]})},s.slug)))})]},a)))})]},s)))}):e.jsxs("div",{className:"empty-state",children:[e.jsx("div",{className:"empty-icon",children:"ðŸ˜¢"}),e.jsx("p",{className:"empty-text",children:a.noPosts})]})})})]})}export{ee as default};